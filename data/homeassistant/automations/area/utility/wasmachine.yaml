---
alias: "[Utility] Wasmachine"
id: utility_wasmachine

variables:
  message: "Washing machine is done ðŸ‘šðŸ‘•"

trigger:
  - platform: state
    entity_id: binary_sensor.washing_machine

action:
  - choose:
      # On
      - conditions:
          - condition: state
            entity_id: binary_sensor.washing_machine
            state: 'on'

        sequence:
          - service: input_datetime.set_datetime
            entity_id: input_datetime.washing_machine_started
            data:
              datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"

          - service: notify.mobile_app_sander_sony_xperia_1_ii
            data:
              title: Wasmachine
              message: "The wasmachine just started"
              data:
                tag: Wasmachine
                channel: Wasmachine

    # Off
    default:
      - service: input_datetime.set_datetime
        entity_id: input_datetime.washing_machine_done
        data:
          datetime: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"

      - service: notify.mobile_app_sander_sony_xperia_1_ii
        data:
          title: Wasmachine
          message: '{{message}}'
          data:
            tag: Wasmachine
            channel: Wasmachine

      - service: notify.mobile_app_iphone
        data:
          title: Wasmachine
          message: '{{message}}'
          data:
            tag: Wasmachine
            channel: Wasmachine
