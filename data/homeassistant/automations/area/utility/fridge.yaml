---
alias: "[Utility] Fridge Open Warning"
id: utility_fridge_open_warning
description: ''
mode: single

trigger:
    # Fridge open
  - platform: state
    id: fridge_open
    entity_id: binary_sensor.utility_frige_door_status
    from: 'off'
    to: 'on'
    for:
      minutes: 5

    # Fridge close
  - platform: state
    entity_id: binary_sensor.utility_frige_door_status
    from: 'on'
    to: 'off'

action:
  - choose:
      - conditions:
          - condition: trigger
            id: fridge_open
            alias: "When the door is opened for too long"

        sequence:
          - service: notify.mobile_app_sander_sony_xperia_1_ii
            data:
              title: Fridge Alarm
              message: Fridge gets ðŸ¥µ
              data:
                ledColor: "red"
                channel: alarm_stream
                vibrationPattern: "100, 1000, 100, 1000, 100"
                importance: high
                ttl: 0
                priority: high

                persistent: true  # Set to true to create a persistent notification
                tag: persistent_fridge_alarm  # Tag is required for the persistent notification

    default:
      - service: notify.mobile_app_sander_sony_xperia_1_ii
        alias: "Clear notification when door is closed"
        data:
          message: clear_notification
          data:
            tag: persistent_fridge_alarm
