---
id: 'balcony_christmas_lights'
alias: '[Balcony] Christmas Lights'
description: ''
mode: single

trigger:
  - platform: sun
    event: sunset
    offset: -00:30:00
    id: sunset_on

  - platform: time
    at: '22:30:00'
    id: evening_off

  - platform: event
    event_type: zha_event
    id: zha_event_switch
    event_data:
      device_ieee: 54:ef:44:10:00:1b:06:70

condition: []

action:
  - choose:
      - conditions:
          - condition: trigger
            id: sunset_on

        sequence:
          - service: light.turn_on
            target:
              entity_id: light.balcony_christmas_lights_level_on_off
            data:
              brightness_pct: 100
              transition: 2

      - conditions:
          - condition: trigger
            id: zha_event_switch

        sequence:
          - choose:
            - conditions:
                - "{{ trigger.event.data.command == 'toggle' and trigger.event.data.endpoint_id == 1 }}"

              sequence:
                - choose:
                    - conditions:
                        - condition: state
                          entity_id: light.balcony_christmas_lights_level_on_off
                          state: "off"

                      sequence:
                        - service: light.turn_on
                          target:
                            entity_id: light.balcony_christmas_lights_level_on_off
                          data:
                            brightness_pct: 100
                            transition: 2

                  default:
                    - service: light.turn_off
                      target:
                        entity_id: light.balcony_christmas_lights_level_on_off


    default:
      - service: light.turn_off
        target:
          entity_id: light.balcony_christmas_lights_level_on_off
        data:
          transition: 2
